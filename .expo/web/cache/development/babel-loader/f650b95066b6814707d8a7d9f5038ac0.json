{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/home/olivier/My-project/signal-clone/signal-clone-app/screens/ChatScreen.js\";\n\nimport React, { useLayoutEffect, useRef, useState } from \"react\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport KeyboardAvoidingView from \"react-native-web/dist/exports/KeyboardAvoidingView\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport StatusBar from \"react-native-web/dist/exports/StatusBar\";\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport TouchableWithoutFeedback from \"react-native-web/dist/exports/TouchableWithoutFeedback\";\nimport { Avatar } from \"react-native-elements\";\nimport { Ionicons, FontAwesome } from \"@expo/vector-icons\";\nimport Keyboard from \"react-native-web/dist/exports/Keyboard\";\nimport { db, auth } from \"../firebase\";\nimport * as firebase from \"firebase\";\n\nvar ChatScreen = function ChatScreen(_ref) {\n  var navigation = _ref.navigation,\n      route = _ref.route;\n\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      input = _useState2[0],\n      setInput = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      messages = _useState4[0],\n      setMessages = _useState4[1];\n\n  var sendMessage = function sendMessage() {\n    Keyboard.dismiss();\n\n    if (input && input !== \"\\n\") {\n      db.collection(\"chats\").doc(route.params.id).collection(\"messages\").add({\n        timestamp: firebase.default.firestore.FieldValue.serverTimestamp(),\n        message: input,\n        displayName: auth.currentUser.displayName,\n        email: auth.currentUser.email,\n        photoURL: auth.currentUser.photoURL\n      });\n    }\n\n    setInput(\"\");\n    scrollDownFunc();\n  };\n\n  var scrollDownDelayed = function scrollDownDelayed() {\n    setTimeout(function () {\n      scrollDownFunc();\n    }, 35);\n  };\n\n  useLayoutEffect(function () {\n    var unsubscribe = db.collection(\"chats\").doc(route.params.id).collection(\"messages\").orderBy(\"timestamp\", \"desc\").onSnapshot(function (snapshot) {\n      return setMessages(snapshot.docs.map(function (doc) {\n        return {\n          id: doc.id,\n          data: doc.data()\n        };\n      }));\n    });\n    scrollDownDelayed();\n    return unsubscribe;\n  }, [route]);\n  var scrollDown = useRef();\n\n  var scrollDownFunc = function scrollDownFunc() {\n    scrollDown.current.scrollToEnd();\n  };\n\n  useLayoutEffect(function () {\n    navigation.setOptions({\n      title: \"Chat\",\n      headerBackTitleVisible: false,\n      headerTitleAlign: \"left\",\n      headerTitle: function headerTitle() {\n        var _messages$, _messages$$data;\n\n        return React.createElement(View, {\n          style: {\n            flexDirection: \"row\",\n            alignItems: \"center\"\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 9\n          }\n        }, React.createElement(Avatar, {\n          rounded: true,\n          source: {\n            uri: ((_messages$ = messages[0]) == null ? void 0 : (_messages$$data = _messages$.data) == null ? void 0 : _messages$$data.photoURL) || \"https://censur.es/wp-content/uploads/2019/03/default-avatar.png\"\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 11\n          }\n        }), React.createElement(Text, {\n          style: {\n            color: \"white\",\n            marginLeft: 10,\n            fontWeight: \"700\"\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 11\n          }\n        }, route.params.chatName));\n      },\n      headerRight: function headerRight() {\n        return React.createElement(View, {\n          style: {\n            flexDirection: \"row\",\n            justifyContent: \"space-between\",\n            width: 70,\n            marginRight: 20\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 9\n          }\n        }, React.createElement(TouchableOpacity, {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 11\n          }\n        }, React.createElement(FontAwesome, {\n          name: \"video-camera\",\n          size: 24,\n          color: \"white\",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 105,\n            columnNumber: 13\n          }\n        })), React.createElement(TouchableOpacity, {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 107,\n            columnNumber: 11\n          }\n        }, React.createElement(Ionicons, {\n          name: \"call\",\n          size: 24,\n          color: \"white\",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 13\n          }\n        })));\n      }\n    });\n    scrollDownFunc();\n  }, [navigation, messages]);\n  return React.createElement(SafeAreaView, {\n    style: {\n      flex: 1,\n      backgroundColor: \"white\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 5\n    }\n  }, React.createElement(StatusBar, {\n    style: \"light\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }\n  }), React.createElement(KeyboardAvoidingView, {\n    behavior: Platform.OS === \"ios\" ? \"padding\" : \"height\",\n    style: styles.container,\n    keyboardVerticalOffset: 85,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }\n  }, React.createElement(TouchableWithoutFeedback, {\n    onPress: Keyboard.dismiss,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 9\n    }\n  }, React.createElement(React.Fragment, null, React.createElement(ScrollView, {\n    ref: scrollDown,\n    contentContainerStyle: {\n      paddingTop: 15,\n      flexDirection: \"column-reverse\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 13\n    }\n  }, messages.map(function (_ref2) {\n    var id = _ref2.id,\n        data = _ref2.data;\n    return data.email === auth.currentUser.email ? React.createElement(View, {\n      key: id,\n      style: styles.sender,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 19\n      }\n    }, React.createElement(Avatar, {\n      rounded: true,\n      position: \"absolute\",\n      bottom: 30,\n      right: -5,\n      size: 24,\n      source: {\n        uri: data.photoURL\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 21\n      }\n    }), React.createElement(Text, {\n      style: styles.senderText,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 21\n      }\n    }, data.message)) : React.createElement(View, {\n      key: id,\n      style: styles.reciever,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 19\n      }\n    }, React.createElement(Avatar, {\n      rounded: true,\n      position: \"absolute\",\n      top: -10,\n      left: -5,\n      size: 24,\n      source: {\n        uri: data.photoURL\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 21\n      }\n    }), React.createElement(Text, {\n      style: styles.recieverName,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 21\n      }\n    }, data.displayName), React.createElement(Text, {\n      style: styles.recieverText,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 21\n      }\n    }, data.message));\n  })), React.createElement(View, {\n    style: styles.footer,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 13\n    }\n  }, React.createElement(TextInput, {\n    value: input,\n    onChangeText: function onChangeText(text) {\n      return setInput(text);\n    },\n    placeholder: \"Enter message\",\n    onSubmitEditing: sendMessage,\n    onFocus: scrollDownDelayed,\n    style: styles.textInput,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 15\n    }\n  }), React.createElement(TouchableOpacity, {\n    onPress: sendMessage,\n    activeOpacity: 0.5,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 15\n    }\n  }, React.createElement(Ionicons, {\n    name: \"send\",\n    size: 24,\n    color: \"#2B68E6\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 17\n    }\n  })))))));\n};\n\nexport default ChatScreen;\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1\n  },\n  reciever: {\n    padding: 10,\n    backgroundColor: \"#2B68E6\",\n    alignSelf: \"flex-start\",\n    borderRadius: 20,\n    marginLeft: 15,\n    maxWidth: \"80%\",\n    position: \"relative\",\n    marginBottom: 10\n  },\n  recieverName: {\n    left: 10,\n    paddingRight: 10,\n    fontSize: 12,\n    color: \"white\"\n  },\n  sender: {\n    padding: 15,\n    backgroundColor: \"#ECECEC\",\n    alignSelf: \"flex-end\",\n    borderRadius: 20,\n    marginRight: 15,\n    marginBottom: 10,\n    maxWidth: \"80%\",\n    position: \"relative\"\n  },\n  recieverText: {\n    color: \"white\",\n    fontWeight: \"500\"\n  },\n  senderText: {\n    color: \"black\",\n    fontWeight: \"500\"\n  },\n  footer: {\n    flexDirection: \"row\",\n    padding: 15,\n    width: \"100%\",\n    alignItems: \"center\"\n  },\n  textInput: {\n    bottom: 0,\n    height: 40,\n    flex: 1,\n    marginRight: 15,\n    borderColor: \"transparent\",\n    backgroundColor: \"#ECECEC\",\n    padding: 10,\n    borderWidth: 1,\n    color: \"grey\",\n    borderRadius: 30\n  }\n});","map":{"version":3,"sources":["/home/olivier/My-project/signal-clone/signal-clone-app/screens/ChatScreen.js"],"names":["React","useLayoutEffect","useRef","useState","Avatar","Ionicons","FontAwesome","db","auth","firebase","ChatScreen","navigation","route","input","setInput","messages","setMessages","sendMessage","Keyboard","dismiss","collection","doc","params","id","add","timestamp","default","firestore","FieldValue","serverTimestamp","message","displayName","currentUser","email","photoURL","scrollDownFunc","scrollDownDelayed","setTimeout","unsubscribe","orderBy","onSnapshot","snapshot","docs","map","data","scrollDown","current","scrollToEnd","setOptions","title","headerBackTitleVisible","headerTitleAlign","headerTitle","flexDirection","alignItems","uri","color","marginLeft","fontWeight","chatName","headerRight","justifyContent","width","marginRight","flex","backgroundColor","Platform","OS","styles","container","paddingTop","sender","senderText","reciever","recieverName","recieverText","footer","text","textInput","StyleSheet","create","padding","alignSelf","borderRadius","maxWidth","position","marginBottom","left","paddingRight","fontSize","bottom","height","borderColor","borderWidth"],"mappings":"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","sourcesContent":["import React, { useLayoutEffect, useRef, useState } from \"react\";\nimport {\n  Text,\n  View,\n  StyleSheet,\n  ScrollView,\n  TextInput,\n  TouchableOpacity,\n  KeyboardAvoidingView,\n  Platform,\n  StatusBar,\n  SafeAreaView,\n  TouchableWithoutFeedback,\n} from \"react-native\";\nimport { Avatar } from \"react-native-elements\";\nimport { Ionicons, FontAwesome } from \"@expo/vector-icons\";\nimport { Keyboard } from \"react-native\";\nimport { db, auth } from \"../firebase\";\nimport * as firebase from \"firebase\";\n\nconst ChatScreen = ({ navigation, route }) => {\n  const [input, setInput] = useState(\"\");\n  const [messages, setMessages] = useState([]);\n\n  const sendMessage = () => {\n    Keyboard.dismiss();\n\n    if (input && input !== \"\\n\") {\n      db.collection(\"chats\").doc(route.params.id).collection(\"messages\").add({\n        timestamp: firebase.default.firestore.FieldValue.serverTimestamp(),\n        message: input,\n        displayName: auth.currentUser.displayName,\n        email: auth.currentUser.email,\n        photoURL: auth.currentUser.photoURL,\n      });\n    }\n\n    setInput(\"\");\n\n    scrollDownFunc();\n  };\n\n  const scrollDownDelayed = () => {\n    setTimeout(function(){\n      scrollDownFunc();\n    }, 35);\n  }\n\n  useLayoutEffect(() => {\n    const unsubscribe = db\n      .collection(\"chats\")\n      .doc(route.params.id)\n      .collection(\"messages\")\n      .orderBy(\"timestamp\", \"desc\")\n      .onSnapshot((snapshot) =>\n        setMessages(\n          snapshot.docs.map((doc) => ({\n            id: doc.id,\n            data: doc.data(),\n          }))\n        )\n      );\n\n    scrollDownDelayed();\n\n    return unsubscribe;\n  }, [route]);\n\n  const scrollDown = useRef();\n\n  const scrollDownFunc = () => {\n    scrollDown.current.scrollToEnd();\n  }\n\n  useLayoutEffect(() => {\n    navigation.setOptions({\n      title: \"Chat\",\n      headerBackTitleVisible: false,\n      headerTitleAlign: \"left\",\n      headerTitle: () => (\n        <View style={{ flexDirection: \"row\", alignItems: \"center\" }}>\n          <Avatar\n            rounded\n            source={{\n              uri:\n                messages[0]?.data?.photoURL ||\n                \"https://censur.es/wp-content/uploads/2019/03/default-avatar.png\",\n            }}\n          />\n          <Text style={{ color: \"white\", marginLeft: 10, fontWeight: \"700\" }}>\n            {route.params.chatName}\n          </Text>\n        </View>\n      ),\n      headerRight: () => (\n        <View\n          style={{\n            flexDirection: \"row\",\n            justifyContent: \"space-between\",\n            width: 70,\n            marginRight: 20,\n          }}\n        >\n          <TouchableOpacity>\n            <FontAwesome name=\"video-camera\" size={24} color=\"white\" />\n          </TouchableOpacity>\n          <TouchableOpacity>\n            <Ionicons name=\"call\" size={24} color=\"white\" />\n          </TouchableOpacity>\n        </View>\n      ),\n    });\n    scrollDownFunc();\n  }, [navigation, messages]);\n\n  return (\n    <SafeAreaView style={{ flex: 1, backgroundColor: \"white\" }}>\n      <StatusBar style=\"light\" />\n      <KeyboardAvoidingView\n        behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\n        style={styles.container}\n        keyboardVerticalOffset={85}\n      >\n        <TouchableWithoutFeedback onPress={Keyboard.dismiss}>\n          <>\n            <ScrollView ref={scrollDown}\n              contentContainerStyle={{\n                paddingTop: 15,\n                flexDirection: \"column-reverse\",\n              }}\n            >\n              {messages.map(({ id, data }) =>\n                data.email === auth.currentUser.email ? (\n                  <View key={id} style={styles.sender}>\n                    <Avatar\n                      rounded\n                      position=\"absolute\"\n                      bottom={30}\n                      right={-5}\n                      size={24}\n                      source={{ uri: data.photoURL }}\n                    />\n                    <Text style={styles.senderText}>{data.message}</Text>\n                  </View>\n                ) : (\n                  <View key={id} style={styles.reciever}>\n                    <Avatar\n                      rounded\n                      position=\"absolute\"\n                      top={-10}\n                      left={-5}\n                      size={24}\n                      source={{ uri: data.photoURL }}\n                    />\n                    <Text style={styles.recieverName}>{data.displayName}</Text>\n                    <Text style={styles.recieverText}>{data.message}</Text>\n                  </View>\n                )\n              )}\n            </ScrollView>\n            <View style={styles.footer}>\n              <TextInput\n                value={input}\n                onChangeText={(text) => setInput(text)}\n                placeholder=\"Enter message\"\n                onSubmitEditing={sendMessage}\n                onFocus={scrollDownDelayed}\n                style={styles.textInput}\n              />\n              <TouchableOpacity onPress={sendMessage} activeOpacity={0.5}>\n                <Ionicons name=\"send\" size={24} color=\"#2B68E6\" />\n              </TouchableOpacity>\n            </View>\n          </>\n        </TouchableWithoutFeedback>\n      </KeyboardAvoidingView>\n    </SafeAreaView>\n  );\n};\n\nexport default ChatScreen;\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  reciever: {\n    padding: 10,\n    backgroundColor: \"#2B68E6\",\n    alignSelf: \"flex-start\",\n    borderRadius: 20,\n    marginLeft: 15,\n    maxWidth: \"80%\",\n    position: \"relative\",\n    marginBottom: 10,\n  },\n  recieverName: {\n    left: 10,\n    paddingRight: 10,\n    fontSize: 12,\n    color: \"white\",\n  },\n  sender: {\n    padding: 15,\n    backgroundColor: \"#ECECEC\",\n    alignSelf: \"flex-end\",\n    borderRadius: 20,\n    marginRight: 15,\n    marginBottom: 10,\n    maxWidth: \"80%\",\n    position: \"relative\",\n  },\n  recieverText: {\n    color: \"white\",\n    fontWeight: \"500\",\n  },\n  senderText: {\n    color: \"black\",\n    fontWeight: \"500\",\n  },\n  footer: {\n    flexDirection: \"row\",\n    padding: 15,\n    width: \"100%\",\n    alignItems: \"center\",\n  },\n  textInput: {\n    bottom: 0,\n    height: 40,\n    flex: 1,\n    marginRight: 15,\n    borderColor: \"transparent\",\n    backgroundColor: \"#ECECEC\",\n    padding: 10,\n    borderWidth: 1,\n    color: \"grey\",\n    borderRadius: 30,\n  },\n});"]},"metadata":{},"sourceType":"module"}